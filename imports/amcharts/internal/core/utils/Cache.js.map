{"version":3,"file":"Cache.js","sourceRoot":"","sources":["../../../../../src/.internal/core/utils/Cache.ts"],"names":[],"mappings":"AAAA;;;;;GAKG;AACH,OAAO,EAAE,UAAU,EAAE,MAAM,cAAc,CAAC;AAgD1C;;;;;GAKG;AAEH;;;;;;;GAOG;AACH;IAAA;QAEC;;;;WAIG;QACK,aAAQ,GAAG,IAAI,UAAU,EAA4C,CAAC;QAE9E;;;;WAIG;QACI,QAAG,GAAW,IAAI,CAAC;IAgE3B,CAAC;IA9DA;;;;;;OAMG;IACI,mBAAG,GAAV,UAAW,KAAa,EAAE,GAAW,EAAE,KAAQ;QAE9C,kDAAkD;QAClD,IAAI,YAAY,GAAG,IAAI,CAAC,QAAQ,CAAC,gBAAgB,CAAC,KAAK,EAAE,cAAM,OAAA,IAAI,UAAU,EAAwB,EAAtC,CAAsC,CAAC,CAAC;QAEvG,oBAAoB;QACpB,IAAI,IAAI,GAAiB;YACxB,SAAS,EAAE,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE;YAC/B,KAAK,EAAE,IAAI,CAAC,GAAG;YACf,OAAO,EAAE,KAAK;SACd,CAAC;QAEF,MAAM;QACN,YAAY,CAAC,MAAM,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;IAChC,CAAC;IAED;;;;;;OAMG;IACI,mBAAG,GAAV,UAAW,KAAa,EAAE,GAAW;QACpC,yGAAyG;QACzG,IAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,EAAE;YAChC,IAAI,YAAY,GAAqC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;YAEjF,IAAI,YAAY,CAAC,MAAM,CAAC,GAAG,CAAC,EAAE;gBAC7B,IAAI,SAAS,GAA+B,YAAY,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;gBACrE,OAAO,SAAS,CAAC,OAAO,KAAK,IAAI,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,SAAS,CAAC,KAAK,CAAC;aAChE;iBACI;gBACJ,OAAO,SAAS,CAAC;aACjB;SACD;aACI;YACJ,OAAO,SAAS,CAAC;SACjB;IACF,CAAC;IAED;;;;OAIG;IACI,qBAAK,GAAZ,UAAa,KAAc;QAC1B,IAAI,KAAK,EAAE;YACV,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;SAC/B;aACI;YACJ,IAAI,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC;SACtB;IACF,CAAC;IAEF,YAAC;AAAD,CAAC,AA9ED,IA8EC;;AAED;;;;;GAKG;AAEH;;;;GAIG;AACH,MAAM,CAAC,IAAI,KAAK,GAAe,IAAI,KAAK,EAAE,CAAC","sourcesContent":["/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Dictionary } from \"./Dictionary\";\r\nimport * as $type from \"./Type\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines an interface for cache items.\r\n */\r\ninterface CacheItem<A> {\r\n\r\n\t/**\r\n\t * A timestamp of when the item was created/updated.\r\n\t * \r\n\t * @type {number}\r\n\t */\r\n\t\"touched\": number,\r\n\r\n\t/**\r\n\t * TTL (time to live) in milliseconds.\r\n\t * \r\n\t * @type {number}\r\n\t */\r\n\t\"ttl\"?: number,\r\n\r\n\t/**\r\n\t * Cached value.\r\n\t * \r\n\t * @type {A}\r\n\t */\r\n\t\"value\": A,\r\n\r\n\t/**\r\n\t * Is this item expired?\r\n\t * \r\n\t * @todo a system process that would check chace element TTLs and expire them\r\n\t * @type {boolean}\r\n\t */\r\n\t\"expired\"?: boolean\r\n\r\n}\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Represents object cache.\r\n *\r\n * @ignore Exclude from docs\r\n * @todo Better storage\r\n * @todo TTL logging\r\n * @todo Garbage collector\r\n */\r\nexport class Cache<A> {\r\n\r\n\t/**\r\n\t * Storage for cache items.\r\n\t * \r\n\t * @type {Object}\r\n\t */\r\n\tprivate _storage = new Dictionary<string, Dictionary<string, CacheItem<A>>>();\r\n\r\n\t/**\r\n\t * Default TTL in milliseconds.\r\n\t * \r\n\t * @type {number}\r\n\t */\r\n\tpublic ttl: number = 1000;\r\n\r\n\t/**\r\n\t * Caches or updates cached value, resets TTL.\r\n\t * \r\n\t * @param {string}  owner  An id of the object that owns this cache\r\n\t * @param {string}  key    Index key\r\n\t * @param {A}       value  Value\r\n\t */\r\n\tpublic set(owner: string, key: string, value: A): void {\r\n\r\n\t\t// Create if storage does not exist for this owner\r\n\t\tlet ownerStorage = this._storage.insertKeyIfEmpty(owner, () => new Dictionary<string, CacheItem<A>>());\r\n\r\n\t\t// Create cache item\r\n\t\tlet item: CacheItem<A> = {\r\n\t\t\t\"touched\": new Date().getTime(),\r\n\t\t\t\"ttl\": this.ttl,\r\n\t\t\t\"value\": value\r\n\t\t};\r\n\r\n\t\t// Set\r\n\t\townerStorage.setKey(key, item);\r\n\t}\r\n\r\n\t/**\r\n\t * Rerturns cached item, respecting TTL.\r\n\t * \r\n\t * @param  {string}  owner  An id of the object that owns this cache\r\n\t * @param  {string}  key    Index key\r\n\t * @return {A}              Value, or `undefined` if not set\r\n\t */\r\n\tpublic get(owner: string, key: string): $type.Optional<A> {\r\n\t\t// \t\t || ypeof this._storage[owner][key] === \"undefined\" || this._storage[owner][key].expired === true) {\r\n\t\tif (this._storage.hasKey(owner)) {\r\n\t\t\tlet ownerStorage = <Dictionary<string, CacheItem<A>>>this._storage.getKey(owner);\r\n\r\n\t\t\tif (ownerStorage.hasKey(key)) {\r\n\t\t\t\tlet cacheItem: CacheItem<A> = <CacheItem<A>>ownerStorage.getKey(key);\r\n\t\t\t\treturn cacheItem.expired === true ? undefined : cacheItem.value;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\treturn undefined;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Clears cache for specific owner or everything.\r\n\t * \r\n\t * @param {string} owner Owner to clear cache for\r\n\t */\r\n\tpublic clear(owner?: string): void {\r\n\t\tif (owner) {\r\n\t\t\tthis._storage.removeKey(owner);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._storage.clear();\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * ============================================================================\r\n * GLOBAL INSTANCE\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * A global instance of cache. Use this instance to cache any values.\r\n *\r\n * @ignore Exclude from docs\r\n */\r\nexport let cache: Cache<any> = new Cache();"]}